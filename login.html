<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Iniciar Sesión - Tube</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #202020;
            color: #f1f1f1;
        }
    </style>
</head>

<body class="min-h-screen flex flex-col items-center justify-center">

    <div class="bg-[#282828] p-8 rounded-xl shadow-2xl w-full max-w-sm border border-gray-700">
        <div class="text-center mb-6">
            <span class="text-red-600 text-4xl font-bold flex justify-center items-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-10 h-10">
                    <path
                        d="M6.827 6.175A2.31 2.31 0 0 1 5.186 7.23c-.38.109-.766.248-1.14.406a1.859 1.859 0 0 0-.917 1.81c.213.67.436 1.345.678 2.019.239.664.49 1.334.755 2.001.266.666.538 1.336.815 2.001.05.122.105.235.165.341a2.312 2.312 0 0 1 1.818 1.521c.241.673.497 1.348.775 2.016.096.23.21.432.35.602a.965.965 0 0 0 .858.468c.373 0 .745-.083 1.11-.253.25-.11.498-.246.746-.395.27-.168.541-.334.811-.5.272-.167.545-.333.82-.497.054-.031.109-.06.163-.09.053.03.107.059.162.09.274.164.547.33.82.497.27.161.539.327.811.5.248.149.496.285.746.395.365.17.737.253 1.11.253.336 0 .65-.092.936-.264.129-.08.235-.19.336-.316a2.64 2.64 0 0 0 .257-.384c.278-.668.533-1.343.774-2.016a2.31 2.31 0 0 1 1.818-1.521c.06-.106.115-.219.165-.341.277-.665.549-1.335.815-2.001.239-.665.49-.1349.728-2.019a1.859 1.859 0 0 0-.917-1.81c-.374-.158-.76-.297-1.14-.406a2.312 2.312 0 0 1-1.641-1.055c-.278-.668-.533-1.343-.774-2.016-.096-.23-.21-.432-.35-.602a.965.965 0 0 0-.858-.468c-.373 0-.745.083-1.11.253-.25.11-.498.246-.746.395-.27.168-.541.334-.811.5-.272.167-.545.333-.82.497-.054.031-.109.06.163-.09-.053.03-.107.059.162.09-.274.164-.547-.33-.82-.497-.27-.161-.539-.327-.811-.5-.248-.149-.496.285-.746.395-.365.17-.737.253-1.11.253-.336 0-.65.092-.936-.264.129-.08.235-.19.336-.316-.089.109-.164.237-.257.384z" />
                </svg>
                Tube
            </span>
        </div>

        <h2 id="form-title" class="text-2xl font-bold mb-4 text-white text-center">Iniciar Sesión</h2>

        <form id="auth-form" class="space-y-4">
            <div>
                <label for="username" class="block text-sm font-medium text-gray-300 mb-1">Usuario</label>
                <input type="text" id="username" required
                    class="w-full p-3 rounded-lg bg-gray-600 border border-gray-500 text-white focus:ring-red-500 focus:outline-none"
                    placeholder="Usuario">
            </div>
            <div>
                <label for="password" class="block text-sm font-medium text-gray-300 mb-1">Contraseña</label>
                <input type="password" id="password" required
                    class="w-full p-3 rounded-lg bg-gray-600 border border-gray-500 text-white focus:ring-red-500 focus:outline-none"
                    placeholder="********">
            </div>

            <div id="auth-message" class="text-sm text-center font-medium h-5"></div>

            <button type="submit" id="submit-btn"
                class="w-full py-3 bg-red-600 hover:bg-red-700 rounded-lg text-white font-bold transition duration-200">
                Entrar
            </button>
        </form>

        <div class="mt-4 text-center">
            <p id="toggle-text" class="text-sm text-gray-400">
                ¿No tienes cuenta? <a href="#" onclick="toggleMode()"
                    class="text-red-500 hover:underline">Regístrate</a>
            </p>
            <p class="mt-2"><a href="index.html" class="text-xs text-gray-500 hover:text-white">Volver al inicio</a></p>
        </div>
    </div>

    <script>
        const AUTH_API_URL = 'https://aritube.logise1123.workers.dev/api/auth';
        let isLogin = true;

        function toggleMode() {
            isLogin = !isLogin;
            const title = document.getElementById('form-title');
            const btn = document.getElementById('submit-btn');
            const toggle = document.getElementById('toggle-text');
            const msg = document.getElementById('auth-message');

            if (isLogin) {
                title.textContent = 'Iniciar Sesión';
                btn.textContent = 'Entrar';
                toggle.innerHTML = '¿No tienes cuenta? <a href="#" onclick="toggleMode()" class="text-red-500 hover:underline">Regístrate</a>';
            } else {
                title.textContent = 'Crear Cuenta';
                btn.textContent = 'Registrarse';
                toggle.innerHTML = '¿Ya tienes cuenta? <a href="#" onclick="toggleMode()" class="text-red-500 hover:underline">Inicia Sesión</a>';
            }
            msg.textContent = '';
            document.getElementById('auth-form').reset();
        }

        document.getElementById('auth-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const msg = document.getElementById('auth-message');
            const btn = document.getElementById('submit-btn');

            msg.textContent = isLogin ? 'Verificando...' : 'Registrando...';
            msg.className = 'text-sm text-center font-medium h-5 text-gray-300';
            btn.disabled = true;

            const endpoint = isLogin ? `${AUTH_API_URL}/login` : `${AUTH_API_URL}/register`;

            try {
                const res = await fetch(endpoint, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username, password })
                });
                const data = await res.json();

                if (!res.ok) throw new Error(data.error || 'Error desconocido');

                if (isLogin) {
                    localStorage.setItem('tubeclone_jwt_token', data.token);
                    msg.textContent = '¡Éxito! Redirigiendo...';
                    msg.className = 'text-sm text-center font-medium h-5 text-green-400';
                    setTimeout(() => window.location.href = 'index.html', 1000);
                } else {
                    msg.textContent = 'Cuenta creada. Inicia sesión.';
                    msg.className = 'text-sm text-center font-medium h-5 text-green-400';
                    setTimeout(() => toggleMode(), 1500);
                    btn.disabled = false;
                }
            } catch (err) {
                msg.textContent = err.message;
                msg.className = 'text-sm text-center font-medium h-5 text-red-400';
                btn.disabled = false;
            }
        });
    </script>
</body>

</html>