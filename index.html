<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tube</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #0f0f0f;
            color: #f1f1f1;
        }

        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-thumb {
            background: #555;
            border-radius: 4px;
        }

        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }
    </style>
</head>

<body class="overflow-hidden h-screen">

    <!-- Navbar -->
    <nav
        class="fixed top-0 w-full bg-[#0f0f0f] z-50 h-14 flex items-center justify-between px-4 lg:px-6 border-b border-[#222]">
        <div class="flex items-center gap-4">
            <button class="p-2 hover:bg-[#272727] rounded-full">
                <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16">
                    </path>
                </svg>
            </button>
            <a href="index.html" class="flex items-center gap-1" title="Inicio">
                <span class="text-red-600">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-8 h-8">
                        <path
                            d="M6.827 6.175A2.31 2.31 0 0 1 5.186 7.23c-.38.109-.766.248-1.14.406a1.859 1.859 0 0 0-.917 1.81c.213.67.436 1.345.678 2.019.239.664.49 1.334.755 2.001.266.666.538 1.336.815 2.001.05.122.105.235.165.341a2.312 2.312 0 0 1 1.818 1.521c.241.673.497 1.348.775 2.016.096.23.21.432.35.602a.965.965 0 0 0 .858.468c.373 0 .745-.083 1.11-.253.25-.11.498-.246.746-.395.27-.168.541-.334.811-.5.272-.167.545.333-.82.497.054-.031.109-.06.163-.09.053.03.107.059.162.09.274.164.547.33.82.497.27.161.539.327.811.5.248.149.496.285.746.395-.365.17.737.253 1.11.253.336 0 .65-.092.936-.264.129-.08.235-.19.336-.316a2.64 2.64 0 0 0 .257-.384c.278-.668.533-1.343.774-2.016a2.31 2.31 0 0 1 1.818-1.521c.06-.106.115-.219.165-.341.277-.665.549-1.335.815-2.001.239-.665.49-.1349.728-2.019a1.859 1.859 0 0 0-.917-1.81c-.374-.158-.76-.297-1.14-.406a2.312 2.312 0 0 1-1.641-1.055c-.278-.668-.533-1.343-.774-2.016-.096-.23-.21-.432-.35-.602a.965.965 0 0 0-.858-.468c-.373 0-.745.083-1.11.253-.25.11-.498.246-.746.395-.27.168-.541.334-.811.5-.272.167-.545.333-.82.497-.054.031-.109.06.163-.09-.053.03-.107.059.162.09-.274.164-.547-.33-.82-.497-.27-.161-.539-.327-.811-.5-.248-.149-.496.285-.746.395-.365.17-.737.253-1.11.253-.336 0-.65.092-.936-.264.129-.08.235-.19.336-.316-.089.109-.164.237-.257.384z" />
                    </svg>
                </span>
                <span class="text-xl font-bold tracking-tight text-white hidden sm:block">Tube</span>
            </a>
        </div>

        <div class="hidden md:flex flex-1 max-w-2xl mx-10">
            <div class="flex w-full">
                <input type="text" id="search-input" placeholder="Buscar"
                    class="w-full bg-[#121212] border border-[#303030] rounded-l-full px-4 py-2 text-gray-300 focus:outline-none focus:border-blue-500 shadow-inner">
                <button id="search-btn"
                    class="bg-[#222] border border-l-0 border-[#303030] px-6 rounded-r-full hover:bg-[#303030]">
                    <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                    </svg>
                </button>
            </div>
        </div>

        <div class="flex items-center gap-2">
            <!-- Studio Link -->
            <a href="studio.html" class="p-2 hover:bg-[#272727] rounded-full" title="Crear">
                <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z">
                    </path>
                </svg>
            </a>

            <!-- Auth -->
            <div id="auth-container">
                <a href="login.html"
                    class="flex items-center gap-2 border border-[#3ea6ff] text-[#3ea6ff] px-3 py-1.5 rounded-full hover:bg-[#263850] font-medium text-sm">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M5.121 17.804A13.937 13.937 0 0112 16c2.5 0 4.847.655 6.879 1.804M15 10a3 3 0 11-6 0 3 3 0 016 0zm6 2a9 9 0 11-18 0 9 9 0 0118 0z">
                        </path>
                    </svg>
                    Acceder
                </a>
            </div>
        </div>
    </nav>

    <!-- Content Wrapper -->
    <div class="flex h-full pt-14">

        <!-- Sidebar -->
        <aside
            class="w-16 md:w-60 bg-[#0f0f0f] hidden sm:flex flex-col h-full overflow-y-auto flex-shrink-0 border-r border-[#222] pb-4">
            <div class="p-3 space-y-1">
                <a href="index.html"
                    class="flex items-center gap-5 px-3 py-2 bg-[#272727] rounded-lg hover:bg-[#3f3f3f] text-white group"
                    title="Principal">
                    <svg class="w-6 h-6 flex-shrink-0" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z" />
                    </svg>
                    <span class="text-sm font-medium hidden md:block whitespace-nowrap">Principal</span>
                </a>
                <a href="#" onclick="alert('Próximamente')"
                    class="flex items-center gap-5 px-3 py-2 rounded-lg hover:bg-[#272727] text-white group"
                    title="Shorts">
                    <svg class="w-6 h-6 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z">
                        </path>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    <span class="text-sm font-medium hidden md:block whitespace-nowrap">Shorts</span>
                </a>
                <a href="index.html?feed=subs"
                    onclick="if(!localStorage.getItem('tubeclone_jwt_token')) { window.location.href='login.html'; return false; } alert('Feed de suscripciones en desarrollo.');"
                    class="flex items-center gap-5 px-3 py-2 rounded-lg hover:bg-[#272727] text-white group"
                    title="Suscripciones">
                    <svg class="w-6 h-6 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10">
                        </path>
                    </svg>
                    <span class="text-sm font-medium hidden md:block whitespace-nowrap">Suscripciones</span>
                </a>
                <a href="profile.html"
                    class="flex items-center gap-5 px-3 py-2 rounded-lg hover:bg-[#272727] text-white group"
                    title="Tú canal">
                    <svg class="w-6 h-6 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M5.121 17.804A13.937 13.937 0 0112 16c2.5 0 4.847.655 6.879 1.804M15 10a3 3 0 11-6 0 3 3 0 016 0zm6 2a9 9 0 11-18 0 9 9 0 0118 0z">
                        </path>
                    </svg>
                    <span class="text-sm font-medium hidden md:block whitespace-nowrap">Tú canal</span>
                </a>
            </div>
            <div class="border-t border-[#303030] my-2 mx-3"></div>
            <div class="p-3 mt-auto">
                <a href="https://github.com/Logise1" target="_blank"
                    class="text-xs text-gray-500 hover:text-gray-300 block text-center md:text-left whitespace-nowrap overflow-hidden text-ellipsis">
                    © 2025 Tube
                </a>
            </div>
        </aside>

        <!-- Main Feed -->
        <main class="flex-1 overflow-y-auto p-6 bg-[#0f0f0f]">
            <!-- Filter Chips -->
            <div class="flex gap-3 mb-6 overflow-x-auto pb-2 scrollbar-hide flex-shrink-0">
                <button onclick="window.location.href='index.html'"
                    class="px-3 py-1 bg-white text-black rounded-lg text-sm font-medium whitespace-nowrap transition hover:bg-gray-200">Todos</button>
                <button
                    class="px-3 py-1 bg-[#272727] hover:bg-[#3f3f3f] rounded-lg text-sm font-medium whitespace-nowrap transition text-white">Juegos</button>
                <button
                    class="px-3 py-1 bg-[#272727] hover:bg-[#3f3f3f] rounded-lg text-sm font-medium whitespace-nowrap transition text-white">Música</button>
                <button
                    class="px-3 py-1 bg-[#272727] hover:bg-[#3f3f3f] rounded-lg text-sm font-medium whitespace-nowrap transition text-white">En
                    vivo</button>
            </div>

            <!-- Video Grid -->
            <!-- Use minmax to prevent squashing -->
            <div id="video-grid"
                class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 2xl:grid-cols-5 gap-y-8 gap-x-4">
                <!-- Skeleton -->
                <div class="animate-pulse">
                    <div class="bg-[#272727] aspect-video rounded-xl mb-3"></div>
                    <div class="h-4 bg-[#272727] rounded w-3/4 mb-2"></div>
                    <div class="h-3 bg-[#272727] rounded w-1/2"></div>
                </div>
            </div>
        </main>

    </div>

    <!-- Scripts -->
    <script>
        const API_BASE = 'https://aritube.logise1123.workers.dev/api';

        // Search Logic
        const searchInput = document.getElementById('search-input');
        const searchBtn = document.getElementById('search-btn');

        function doSearch() {
            const query = searchInput.value.trim();
            if (query) {
                window.location.href = `index.html?search=${encodeURIComponent(query)}`;
            }
        }

        searchBtn.onclick = doSearch;
        searchInput.onkeypress = (e) => { if (e.key === 'Enter') doSearch(); };

        const params = new URLSearchParams(window.location.search);
        if (params.get('search')) {
            searchInput.value = params.get('search');
        }

        // Auth Check
        function checkAuth() {
            const token = localStorage.getItem('tubeclone_jwt_token');
            const container = document.getElementById('auth-container');
            if (token) {
                try {
                    const payload = JSON.parse(atob(token.split('.')[1].replace(/-/g, '+').replace(/_/g, '/')));
                    container.innerHTML = `
                        <a href="profile.html?u=${payload.userId}" class="w-8 h-8 rounded-full bg-purple-600 flex items-center justify-center font-bold text-white cursor-pointer" title="${payload.username}">
                            ${payload.username[0].toUpperCase()}
                        </a>
                    `;
                } catch (e) { }
            }
        }

        async function loadVideos() {
            const grid = document.getElementById('video-grid');
            try {
                const searchParam = params.get('search') ? `?search=${params.get('search')}` : '';
                const res = await fetch(`${API_BASE}/videos/all${searchParam}`);
                if (!res.ok) throw new Error('Error cargando videos');
                const videos = await res.json();

                grid.innerHTML = '';
                const list = Array.isArray(videos) ? videos : Object.values(videos);

                if (list.length === 0) {
                    grid.innerHTML = '<p class="text-gray-400 col-span-full text-center py-20">No se encontraron videos.</p>';
                    return;
                }

                list.forEach(video => {
                    const card = document.createElement('div');
                    card.className = 'group cursor-pointer flex flex-col gap-2';
                    card.onclick = (e) => {
                        if (e.target.tagName !== 'A') window.location.href = `watch.html?v=${video.id}`;
                    };

                    card.innerHTML = `
                        <div class="relative w-full aspect-video rounded-xl bg-[#202020] overflow-hidden">
                            <img src="${video.thumbnail || 'https://via.placeholder.com/320x180'}" class="w-full h-full object-cover group-hover:scale-105 transition duration-200" loading="lazy">
                            <span class="absolute bottom-1 right-1 bg-black/80 text-white text-xs px-1.5 py-0.5 rounded">${video.duration || '0:00'}</span>
                        </div>
                        <div class="flex gap-3 items-start">
                            <a href="profile.html?u=${video.userId}" class="flex-shrink-0 w-9 h-9 rounded-full bg-[#333] flex items-center justify-center text-xs font-bold text-gray-400 hover:bg-[#444] z-10 transition" onclick="event.stopPropagation()">
                                ${(video.title || '?')[0].toUpperCase()}
                            </a>
                            <div class="min-w-0 flex-1">
                                <h3 class="text-white font-bold text-sm leading-tight line-clamp-2 mb-1 group-hover:text-blue-400 transition" title="${video.title}">${video.title || 'Video sin título'}</h3>
                                <a href="profile.html?u=${video.userId}" class="text-[#aaa] text-xs hover:text-white transition block" onclick="event.stopPropagation()">${video.userId || 'Usuario'}</a>
                                <p class="text-[#aaa] text-xs">${video.views || 0} vistas • hace un momento</p>
                            </div>
                        </div>
                    `;
                    grid.appendChild(card);
                });

            } catch (e) {
                console.error(e);
                grid.innerHTML = '<p class="text-red-400 text-center col-span-full">Error al conectar con el servidor.</p>';
            }
        }

        checkAuth();
        loadVideos();
    </script>
</body>

</html>